# Система логирования GigaAM v3

## Описание

GigaAM v3 имеет встроенную систему логирования, которая автоматически записывает все действия приложения в файлы. Логи организованы по датам и времени запуска, что позволяет легко отследить историю работы приложения.

## Структура папок

Все логи сохраняются в папке `logs/` в корне проекта:

```
logs/
├── 28-11-2025/
│   ├── 14-30-15/
│   │   ├── app.log         # Полный лог сессии
│   │   └── errors.log      # Только ошибки и предупреждения
│   └── 16-45-22/
│       ├── app.log
│       └── errors.log
└── 29-11-2025/
    └── 09-15-30/
        ├── app.log
        └── errors.log
```

### Формат папок:
- **Первый уровень**: `dd-mm-yyyy` — дата запуска приложения
- **Второй уровень**: `HH-MM-SS` — время запуска приложения (часы-минуты-секунды)

## Типы логов

### 1. `app.log` — Основной лог
Содержит все сообщения приложения:
- Запуск и завершение сессии
- Информация о выбранных файлах
- Прогресс обработки
- Результаты транскрибации
- Предупреждения
- Ошибки

**Пример содержимого:**
```
[14:30:15] INFO     | ============================================================
[14:30:15] INFO     | GigaAM v3 Transcriber - Запуск приложения
[14:30:15] INFO     | Сессия: 28.11.2025 14:30:15
[14:30:15] INFO     | Логи сохраняются в: /Users/user/GigaAMv3/logs/28-11-2025/14-30-15
[14:30:15] INFO     | ============================================================
[14:30:22] INFO     | Выбрано файлов: 2
[14:30:25] INFO     | Начало обработки...
[14:30:26] INFO     | --- Обработка файла 1/2: audio.mp3 ---
[14:30:45] INFO     | Транскрибация завершена за 19.2 сек
[14:31:10] INFO     | Обработка завершена. Обработано файлов: 2/2. Время: 45 сек
```

### 2. `errors.log` — Лог ошибок
Содержит только предупреждения и ошибки. Удобен для быстрой диагностики проблем.

**Пример содержимого:**
```
[14:32:15] WARNING  | Попытка запустить обработку без выбранных файлов
[14:35:42] ERROR    | Ошибка при обработке файла corrupted.mp4: Invalid audio stream
[14:35:42] ERROR    | Traceback (most recent call last):
  File "/Users/user/GigaAMv3/src/core/processor.py", line 87, in process_file
    ...
```

## Формат записей

Каждая запись в логе имеет следующий формат:

```
[HH:MM:SS] LEVEL    | MESSAGE
```

Где:
- `HH:MM:SS` — время записи
- `LEVEL` — уровень важности:
  - `DEBUG` — отладочная информация (по умолчанию не выводится в консоль)
  - `INFO` — информационные сообщения
  - `WARNING` — предупреждения
  - `ERROR` — ошибки
- `MESSAGE` — текст сообщения

## Автоматическая очистка

При каждом запуске приложения автоматически удаляются логи старше **30 дней**. Это предотвращает переполнение диска.

Вы можете изменить этот период, отредактировав параметр `days` в методе `cleanup_old_logs()` в файле `src/utils/logger.py`:

```python
# По умолчанию - 30 дней
self.app_logger.cleanup_old_logs(days=30)

# Например, для хранения логов 60 дней:
self.app_logger.cleanup_old_logs(days=60)
```

## Что логируется

### Информационные сообщения (INFO):
- Запуск и завершение приложения
- Выбор файлов для обработки
- Начало и завершение обработки каждого файла
- Время обработки и статистика
- Сохранение результатов транскрибации

### Предупреждения (WARNING):
- Попытка запуска обработки без выбранных файлов
- Проблемы с определением длительности файла
- Устаревшие зависимости

### Ошибки (ERROR):
- Ошибки при загрузке модели
- Ошибки конвертации аудио
- Ошибки транскрибации
- Критические ошибки приложения
- Полный traceback для диагностики

## Использование логов для диагностики

### Если приложение не запускается:
1. Откройте последнюю папку в `logs/`
2. Проверьте `errors.log` на наличие ошибок при запуске
3. Если `errors.log` пуст, проверьте `app.log`

### Если файл не обрабатывается:
1. Найдите сессию обработки в `logs/`
2. Откройте `app.log` и найдите имя проблемного файла
3. Проверьте сообщения до и после обработки файла
4. Если есть ошибка, откройте `errors.log` для полного traceback

### Если хотите проверить производительность:
1. Откройте `app.log` нужной сессии
2. Найдите строки с временем обработки:
   ```
   [14:30:45] INFO     | Транскрибация завершена за 19.2 сек
   ```
3. Сравните с оценочным временем

## Где хранятся логи в проекте

```
GigaAMv3/
├── logs/                    # Папка с логами (автоматически создается)
│   └── dd-mm-yyyy/         # Логи за конкретную дату
│       └── HH-MM-SS/       # Логи конкретной сессии
│           ├── app.log
│           └── errors.log
└── src/
    └── utils/
        └── logger.py       # Модуль логирования
```

## Технические детали

### Модуль `src/utils/logger.py`

Содержит два основных класса:

#### 1. `AppLogger`
Отвечает за настройку и управление логированием:
- Создает структуру папок
- Настраивает форматирование
- Управляет файлами логов
- Очищает старые логи

#### 2. `LoggerAdapter`
Адаптер для совместимости с существующим кодом:
- Принимает сообщения из GUI
- Логирует в файлы
- Передает сообщения в интерфейс

### Интеграция в приложение

Логирование интегрировано в основной код:

```python
# В src/gui/app.py
from ..utils import AppLogger, LoggerAdapter

class GigaTranscriberApp(ctk.CTk):
    def __init__(self):
        # Инициализация логирования
        self.app_logger = AppLogger()
        self.app_logger.log_session_start()
        
        # Очистка старых логов
        self.app_logger.cleanup_old_logs()
    
    def log(self, message):
        # Вывод в GUI и запись в файл
        self.textbox_log.insert("end", f">> {message}\n")
        self.app_logger.get_logger().info(message)
```

## Конфиденциальность

Логи содержат:
- ✅ Имена обработанных файлов
- ✅ Пути к файлам на вашем компьютере
- ✅ Время обработки
- ✅ Текст ошибок

Логи НЕ содержат:
- ❌ Содержимое транскрибаций
- ❌ HuggingFace токен
- ❌ Личные данные

**Важно**: Папка `logs/` добавлена в `.gitignore` и не будет загружаться в Git репозиторий.

## Дополнительная настройка

### Изменение формата логов

Отредактируйте формат в `src/utils/logger.py`:

```python
formatter = logging.Formatter(
    '[%(asctime)s] %(levelname)-8s | %(message)s',  # Текущий формат
    datefmt='%H:%M:%S'
)

# Например, добавить имя модуля:
formatter = logging.Formatter(
    '[%(asctime)s] %(levelname)-8s | %(name)s | %(message)s',
    datefmt='%H:%M:%S'
)
```

### Изменение уровня логирования

По умолчанию в файл записывается всё (DEBUG и выше), в консоль — INFO и выше.

Изменить можно в `src/utils/logger.py`:

```python
# Для более детального логирования в консоль:
console_handler.setLevel(logging.DEBUG)

# Для записи только ошибок в файл:
file_handler.setLevel(logging.ERROR)
```

### Отключение логирования в консоль

Закомментируйте добавление console_handler в `src/utils/logger.py`:

```python
# console_handler = logging.StreamHandler()
# console_handler.setLevel(logging.INFO)
# console_handler.setFormatter(formatter)
# logger.addHandler(console_handler)
```

## FAQ

**Q: Можно ли отключить логирование?**  
A: Нет, логирование встроено в приложение для диагностики проблем. Но вы можете изменить уровень логирования или удалить старые логи.

**Q: Сколько места занимают логи?**  
A: Обычно 1-5 КБ на сессию. При активном использовании за месяц накопится около 150-500 КБ.

**Q: Безопасно ли делиться логами?**  
A: Логи содержат пути к файлам на вашем компьютере. Перед публикацией удалите личную информацию.

**Q: Где найти логи на разных ОС?**  
A: Логи всегда в папке `logs/` в корне проекта, независимо от операционной системы.

---

**Документация обновлена**: 28.11.2025

